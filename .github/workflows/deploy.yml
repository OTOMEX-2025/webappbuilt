name: Deploy via Webhook

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: ðŸšš Checkout code
      uses: actions/checkout@v4

    - name: ðŸ“¦ Notify Server via Webhook
      run: |
        # Create signature
        TIMESTAMP=$(date +%s)
        PAYLOAD="{\"repository\":{\"name\":\"${{ github.event.repository.name }}\"},\"ref\":\"${{ github.ref }}\",\"timestamp\":\"$TIMESTAMP\"}"
        SIGNATURE=$(echo -n "$PAYLOAD" | openssl dgst -sha256 -hmac "${{ secrets.WEBHOOK_SECRET }}" | awk '{print "sha256="$2}')
        
        # Send webhook
        curl -X POST \
          "http://3.92.83.123:3000/deploy" \
          -H "Content-Type: application/json" \
          -H "X-Hub-Signature-256: $SIGNATURE" \
          -d "$PAYLOAD" \
          --max-time 30
        
        echo "âœ… Deployment webhook sent successfully!"
